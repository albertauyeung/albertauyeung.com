<!DOCTYPE html><html lang="en">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>Performing Sequence Labelling using CRF in Python - Albert Au Yeung</title>

<meta name="description" content="Sequence Labelling in NLPIn natural language processing, it is a common task to extract words or phrases of particular types from a given sentence or paragra...">
<link rel="canonical" href="http://localhost:4000/2017/06/17/python-sequence-labelling-with-crf.html"><link rel="alternate" type="application/rss+xml" title="Albert Au Yeung" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet --><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" ><!-- start custom head snippets -->

<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://use.fontawesome.com/releases/v5.0.13/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root"><div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand"><?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
 "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 viewBox="0 0 2600.000000 2600.000000"
 preserveAspectRatio="xMidYMid meet">
<metadata>
Created by potrace 1.13, written by Peter Selinger 2001-2015
</metadata>
<g transform="translate(0.000000,2600.000000) scale(0.100000,-0.100000)"
fill="#000000" stroke="none">
<path d="M19596 21344 c-244 -44 -466 -162 -647 -343 -226 -226 -342 -491
-356 -812 -27 -612 395 -1137 1006 -1253 106 -20 312 -21 424 -1 585 102 1009
608 1009 1205 0 537 -341 1003 -853 1165 -174 55 -408 71 -583 39z"/>
<path d="M12550 18839 c-1079 -81 -2120 -484 -2960 -1148 -360 -284 -719 -651
-992 -1016 -855 -1140 -1223 -2560 -1033 -3985 20 -149 55 -343 63 -352 12
-11 425 -89 752 -142 1935 -314 4534 -416 6870 -271 878 55 1749 151 2440 271
216 37 563 103 568 109 7 7 53 274 71 417 58 446 60 924 5 1368 -178 1455
-946 2782 -2124 3669 -292 220 -526 364 -865 531 -650 321 -1299 497 -2030
550 -163 12 -599 11 -765 -1z"/>
<path d="M21763 18709 c-120 -21 -249 -91 -323 -177 -55 -64 -107 -172 -126
-262 -67 -324 194 -640 529 -640 155 0 280 51 388 159 166 166 206 409 103
627 -54 113 -196 235 -318 273 -76 23 -185 32 -253 20z"/>
<path d="M7010 14913 c-846 -144 -1352 -247 -1885 -383 -1576 -403 -2571 -898
-2901 -1445 -68 -111 -114 -264 -114 -377 -1 -410 391 -820 1129 -1179 1501
-732 4287 -1253 7546 -1414 1426 -70 2894 -70 4320 0 2650 131 4978 496 6595
1035 852 284 1425 584 1765 925 214 213 315 419 315 639 0 135 -75 330 -181
471 -497 660 -2041 1256 -4289 1654 -186 33 -532 91 -544 91 -2 0 10 -55 27
-122 16 -68 46 -213 66 -323 l37 -199 94 -29 c780 -235 1293 -484 1578 -767
88 -87 147 -172 186 -270 26 -66 30 -87 30 -180 0 -87 -4 -115 -23 -164 -42
-105 -92 -179 -190 -277 -617 -616 -2535 -1078 -5201 -1254 -1219 -80 -2759
-91 -4050 -30 -2752 132 -4923 557 -5790 1134 -138 91 -226 167 -294 252 -100
126 -144 253 -132 381 40 432 646 829 1796 1175 l94 29 37 199 c20 110 50 255
66 323 26 106 28 122 14 121 -9 -1 -54 -8 -101 -16z"/>
<path d="M9190 9507 c404 -395 861 -713 1394 -972 1025 -498 2143 -656 3286
-464 880 147 1759 544 2465 1112 203 163 526 467 497 467 -7 0 -114 -9 -240
-20 -1196 -103 -2327 -150 -3647 -150 -1320 0 -2451 47 -3647 150 -126 11
-234 20 -240 20 -7 -1 52 -65 132 -143z"/>
<path d="M5296 7775 c-309 -78 -490 -414 -382 -709 136 -376 613 -486 893
-206 286 286 174 772 -207 901 -84 28 -222 34 -304 14z"/>
</g>
</svg>
<a title="Notes on AI & ML
" href="/">Albert Au Yeung</a></div><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></div><nav class="navigation">
        <ul><li class="navigation__item"><a href="/archive.html">Archive</a></li><li class="navigation__item"><a href="/cheatsheet.html">Cheatsheets</a></li><li class="navigation__item"><a href="/about.html">About</a></li><li class="navigation__item"><a href="/cv.html">CV</a></li><li class="navigation__item"><a href="/publications.html">Publications</a></li><li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li></ul>
      </nav></div>
  </header>
</div><div class="page__content"><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><div class="article__header"><header><h1>Performing Sequence Labelling using CRF in Python</h1></header></div><meta itemprop="headline" content="Performing Sequence Labelling using CRF in Python"><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=python">python</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=machine+learning">machine learning</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=sequence+labelling">sequence labelling</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=crf">crf</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jun 17, 2017</span>
            </li></ul></div><meta itemprop="author" content="Albert Au Yeung"/><meta itemprop="datePublished" content="2017-06-17T00:00:00+08:00">
    <meta itemprop="keywords" content="python,machine learning,sequence labelling,crf"><div class="js-article-content"><div class="layout--article"><!-- start custom article top snippet -->

<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody"><h2 id="sequence-labelling-in-nlp">Sequence Labelling in NLP</h2>

<p>In <a href="https://en.wikipedia.org/wiki/Natural_language_processing">natural language processing</a>, it is a common task to <strong>extract words or phrases of particular types</strong> from a given sentence or paragraph. For example, when performing analysis of a corpus of news articles, we may want to know which countries are mentioned in the articles, and how many articles are related to each of these countries.</p>

<p>This is actually a special case of <strong>sequence labelling</strong> in NLP (others include <a href="https://en.wikipedia.org/wiki/Part-of-speech_tagging">POS tagging</a> and <a href="https://en.wikipedia.org/wiki/Shallow_parsing">Chunking</a>), in which the goal is to assign a label to each member in the sequence. In the case of identifying country names, we would like to assign a ‘<em>country</em>’ label to words that form part of a country name, and a ‘<em>irrelevant</em>’ label to all other words. For example, the following is a sentence broken down into tokens, and its desired output after the sequence labelling process:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>input = ["Paris", "is", "the", "capital", "of", "France"]
output = ["I", "I", "I", "I", "I", "C"]
</code></pre></div></div>

<p>where <em>I</em> means that the token of that position is an irrelevant word, and <em>C</em> means that the token of that position is a word that form part of a country name.</p>

<h2 id="methods-of-sequence-labelling">Methods of Sequence Labelling</h2>

<p>A simple, though sometimes quite useful, approach is to prepare a <strong>dictionary</strong> of country names, and look for these names in each of the sentences in the corpus. However, this method relies heavily on the comprehensiveness of the dictionary. While there is a limited number of countries, in other cases such as city names the number of possible entries in the dictionary can be huge. Even for countries, many countries may be referred to using different sequence of characters in different contexts. For example, the United States of America may be referred to in an article as <em>the USA</em>, <em>the States</em>, or simply <em>America</em>.</p>

<p>In fact, a person reading a news article would usually recognise that a word or a phrase refers to a country, even when he or she has not seen the name of that country before. The reason is that there are many differnt <strong>cues</strong> in the sentence or the whole article that can be used to determine whether a word or a phrase is a country name. Take the following two sentences as examples:</p>

<ul>
  <li>Kerry travels to <strong>Laos</strong>’s capital, Vientiane, on Monday for meetings of foreign ministers from the 10-member Association of South East Asia Nations (ASEAN).</li>
  <li>The Governments of <strong>Bolivia</strong> and <strong>Uruguay</strong> will strengthen ties with a customs cooperation agreement to be in force on June 15th.</li>
</ul>

<p>The first sentence implies that something called <strong>Lao</strong> has a capital, suggesting that <strong>Lao</strong> is a country. Similarly, in the second sentence we know that both <strong>Bolivia</strong> and <strong>Uruguay</strong> are countries as the news mentioned about their governments. In other words, the words around ‘Lao’, ‘Bolivia’ and ‘Uruguay’ provide clues as to whether they are country names.</p>

<h2 id="conditional-random-field-crf">Conditional Random Field (CRF)</h2>

<p>To take advantage of the surrounding context when labelling tokens in a sequence, a commonly used method is <a href="https://en.wikipedia.org/wiki/Conditional_random_field">conditional random field</a> (CRF), first proposed by <a href="http://repository.upenn.edu/cgi/viewcontent.cgi?article=1162&amp;context=cis_papers">Lafferty et al.</a> in 2001. It is  a type of probabilistic graphical model that can be used to model sequential data, such as labels of words in a sentence.</p>

<p>This article is not intended to discuss the technical details of CRF. If you are interested, you are recommended to check out one of the following tutorials which provide very good explanation of how CRF works:</p>

<ul>
  <li><a href="http://homepages.inf.ed.ac.uk/csutton/publications/crftut-fnt.pdf">An Introduction to Conditional
Random Fields</a> by Charles Sutton and Andrew McCallum</li>
  <li><a href="http://blog.echen.me/2012/01/03/introduction-to-conditional-random-fields/">Introduction to Conditional Random Fields</a> by Edwin Chen</li>
</ul>

<p>In CRF, we will design a set of <strong>feature functions</strong> to extract features for each word in a sentence. During model training, CRF will try to determine the weights of different feature functions that will maximise the likelihood of the labels in the training data.</p>

<h2 id="train-crf-model-in-python">Train CRF Model in Python</h2>

<p>One of the commonly used CRF library is <a href="http://www.chokkan.org/software/crfsuite/">CRFSuite implemented by Naoaki Okazaki</a> in C/C++. The library is already easy to use given its command line interface. A Python binding to CRFSuite, <a href="https://github.com/scrapinghub/python-crfsuite">pycrfsuite</a> is available for using the API in Python. This Python module is exactly the module used in the POS tagger in the <a href="http://www.nltk.org/">nltk module</a>.</p>

<p>To demonstrate how pysrfsuite can be used to train a linear chained CRF sequence labelling model, we will go through an example using some data for <em>named entity recognition</em>.</p>

<h3 id="named-entity-recogniton">Named Entity Recogniton</h3>

<p>To train a named entity recognition model, we need some labelled data. The dataset that will be used below is the <strong>Reuters-128 dataset</strong>, which is an English corpus in the NLP Interchange Format (NIF). It contains 128 economic news articles. The dataset contains information for <strong>880</strong> named entities with their position in the document and a URI of a <a href="http://wiki.dbpedia.org/">DBpedia</a> resource identifying the entity. It was created by the <a href="http://aksw.org/About.html">Agile Knowledge Engineering and Semantic Web research group at Leipzig University, Germany</a>. More details can be found in <a href="http://svn.aksw.org/papers/2014/LREC_N3NIFNERNED/public.pdf">their paper</a>.</p>

<p>In the following, we will use the XML verison of the dataset, which can be downloaded from <a href="https://github.com/AKSW/n3-collection">https://github.com/AKSW/n3-collection</a>. Below is some lines extracted from the XML data file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;document id="8"&gt;
  &lt;documenturi&gt;http://www.research.att.com/~lewis/Reuters-21578/15009&lt;/documenturi&gt;
  &lt;documentsource&gt;Reuters-21578&lt;/documentsource&gt;
  &lt;textwithnamedentities&gt;
    &lt;namedentityintext uri="http://aksw.org/notInWiki/Home_Intensive_Care_Inc"&gt;Home Intensive Care Inc&lt;/namedentityintext&gt;
    &lt;simpletextpart&gt; said it has opened a Dialysis at Home office in &lt;/simpletextpart&gt;
    &lt;namedentityintext uri="http://dbpedia.org/resource/Philadelphia"&gt;Philadelphia&lt;/namedentityintext&gt;
    &lt;simpletextpart&gt;, its 12th nationwide.&lt;/simpletextpart&gt;
  &lt;/textwithnamedentities&gt;
&lt;/document&gt;
</code></pre></div></div>

<p>The XML block shown above refers to one of the documents in the dataset. The semantics is self-explanatory. The document has a sentence ‘Home Intensive Care Inc said it has opened a Dialysis at Home office in Philadelphia, its 12th nationwide’, in which <strong>Home Intensive Care Inc</strong> and <strong>Philadelphia</strong> are labelled as named entities.</p>

<h3 id="prepare-the-dataset-for-training">Prepare the Dataset for Training</h3>

<p>In order to prepare the dataset for training, we need to label every word (or token) in the sentences to be either <em>irrelevant</em> or part of a <em>named entity</em>. Since the data is in XML format, we can make use of <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">BeautifulSoup</a> to parse the file and extract the data as follows:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span> <span class="k">as</span> <span class="n">bs</span>
<span class="kn">from</span> <span class="nn">bs4.element</span> <span class="kn">import</span> <span class="n">Tag</span>
<span class="kn">import</span> <span class="nn">codecs</span>

<span class="c1"># Read data file and parse the XML
</span><span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="nb">open</span><span class="p">(</span><span class="s">"reuters.xml"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">,</span> <span class="s">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">bs</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s">"html5lib"</span><span class="p">)</span>

<span class="n">docs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">"document"</span><span class="p">):</span>
    <span class="n">texts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Loop through each child of the element under "textwithnamedentities"
</span>    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">"textwithnamedentities"</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="n">Tag</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"namedentityintext"</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s">"N"</span>  <span class="c1"># part of a named entity
</span>            <span class="k">else</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s">"I"</span>  <span class="c1"># irrelevant word
</span>            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">texts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">w</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>
    <span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>
</code></pre></div></div>

<p>The result will be a list of documents, each of which contains a list of (word, label) tuples. For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; doc[0][:10]
[('Paxar', 'N'),
 ('Corp', 'N'),
 ('said', 'I'),
 ('it', 'I'),
 ('has', 'I'),
 ('acquired', 'I'),
 ('Thermo-Print', 'N'),
 ...
</code></pre></div></div>

<h3 id="generating-part-of-speech-tags">Generating Part-of-Speech Tags</h3>

<p>To train a CRF model, we need to create features for each of the tokens in the sentences. One particularly useful feature in NLP is the <a href="https://en.wikipedia.org/wiki/Part-of-speech_tagging">part-of-speech (POS) tags</a> of the words. They indicates whether a word is a noun, a verb or an adjective. (In fact, a POS tagger is also usually a trained CRF model.)</p>

<p>We can use <a href="http://www.nltk.org/book/ch05.html">NLTK’s POS tagger</a> to generate the POS tags for the tokens in our documents as follows:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">nltk</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">docs</span><span class="p">):</span>

    <span class="c1"># Obtain the list of tokens in the document
</span>    <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">]</span>

    <span class="c1"># Perform POS tagging
</span>    <span class="n">tagged</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">pos_tag</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>

    <span class="c1"># Take the word, POS tag, and its label
</span>    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="n">w</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">label</span><span class="p">),</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">tagged</span><span class="p">)])</span>
</code></pre></div></div>

<p>The output of the above process will be a list of documents, each of which is a list of tuples with the word, its POS tag and its label:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">[(</span><span class="s">'Paxar'</span><span class="p">,</span> <span class="s">'NNP'</span><span class="p">,</span> <span class="s">'N'</span><span class="p">),</span>
    <span class="p">(</span><span class="s">'Corp'</span><span class="p">,</span> <span class="s">'NNP'</span><span class="p">,</span> <span class="s">'N'</span><span class="p">),</span>
    <span class="p">(</span><span class="s">'said'</span><span class="p">,</span> <span class="s">'VBD'</span><span class="p">,</span> <span class="s">'I'</span><span class="p">),</span>
    <span class="p">(</span><span class="s">'it'</span><span class="p">,</span> <span class="s">'PRP'</span><span class="p">,</span> <span class="s">'I'</span><span class="p">),</span>
    <span class="p">(</span><span class="s">'has'</span><span class="p">,</span> <span class="s">'VBZ'</span><span class="p">,</span> <span class="s">'I'</span><span class="p">),</span>
    <span class="p">(</span><span class="s">'acquired'</span><span class="p">,</span> <span class="s">'VBN'</span><span class="p">,</span> <span class="s">'I'</span><span class="p">),</span>
    <span class="p">(</span><span class="s">'Thermo-Print'</span><span class="p">,</span> <span class="s">'NNP'</span><span class="p">,</span> <span class="s">'N'</span><span class="p">),</span>
    <span class="o">...</span>
</code></pre></div></div>

<h3 id="generating-features">Generating Features</h3>

<p>Given the POS tags, we can now continue to generate more features for each of the tokens in the dataset. The features that will be useful in the training process depends on the task at hand. Below are some of the commonly used features for a word $w$ in named entity recognition:</p>

<ul>
  <li>The word $w$ itself (converted to lowercase for normalisation)</li>
  <li>The prefix/suffix of $w$ (e.g. -ion)</li>
  <li>The words surrounding $w$, such as the previous and the next word</li>
  <li>Whether $w$ is in uppercase or lowercase</li>
  <li>Whether $w$ is a number, or contains digits</li>
  <li>The POS tag of $w$, and those of the surrounding words</li>
  <li>Whether $w$ is or contains a special character (e.g. hypen, dollar sign)</li>
</ul>

<p>Below is a function for generating features for our documents. It takes a doc (in the form of a listof tuples as shown above), and an index (the $i$th document), and return the documents with features extracted. (A similar example can be found in <a href="https://github.com/scrapinghub/python-crfsuite/blob/master/examples/CoNLL%202002.ipynb">the repository of pyscrfsuite</a>.)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">word2features</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">postag</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Common features for all words
</span>    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">'bias'</span><span class="p">,</span>
        <span class="s">'word.lower='</span> <span class="o">+</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
        <span class="s">'word[-3:]='</span> <span class="o">+</span> <span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:],</span>
        <span class="s">'word[-2:]='</span> <span class="o">+</span> <span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span>
        <span class="s">'word.isupper=</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">word</span><span class="o">.</span><span class="n">isupper</span><span class="p">(),</span>
        <span class="s">'word.istitle=</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">word</span><span class="o">.</span><span class="n">istitle</span><span class="p">(),</span>
        <span class="s">'word.isdigit=</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">word</span><span class="o">.</span><span class="n">isdigit</span><span class="p">(),</span>
        <span class="s">'postag='</span> <span class="o">+</span> <span class="n">postag</span>
    <span class="p">]</span>

    <span class="c1"># Features for words that are not
</span>    <span class="c1"># at the beginning of a document
</span>    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">word1</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">postag1</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">features</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
            <span class="s">'-1:word.lower='</span> <span class="o">+</span> <span class="n">word1</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="s">'-1:word.istitle=</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">word1</span><span class="o">.</span><span class="n">istitle</span><span class="p">(),</span>
            <span class="s">'-1:word.isupper=</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">word1</span><span class="o">.</span><span class="n">isupper</span><span class="p">(),</span>
            <span class="s">'-1:word.isdigit=</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">word1</span><span class="o">.</span><span class="n">isdigit</span><span class="p">(),</span>
            <span class="s">'-1:postag='</span> <span class="o">+</span> <span class="n">postag1</span>
        <span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Indicate that it is the 'beginning of a document'
</span>        <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">'BOS'</span><span class="p">)</span>

    <span class="c1"># Features for words that are not
</span>    <span class="c1"># at the end of a document
</span>    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">word1</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">postag1</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">features</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
            <span class="s">'+1:word.lower='</span> <span class="o">+</span> <span class="n">word1</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="s">'+1:word.istitle=</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">word1</span><span class="o">.</span><span class="n">istitle</span><span class="p">(),</span>
            <span class="s">'+1:word.isupper=</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">word1</span><span class="o">.</span><span class="n">isupper</span><span class="p">(),</span>
            <span class="s">'+1:word.isdigit=</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">word1</span><span class="o">.</span><span class="n">isdigit</span><span class="p">(),</span>
            <span class="s">'+1:postag='</span> <span class="o">+</span> <span class="n">postag1</span>
        <span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Indicate that it is the 'end of a document'
</span>        <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">'EOS'</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">features</span>
</code></pre></div></div>

<h3 id="training-the-model">Training the Model</h3>

<p>To train the model, we need to first prepare the training data and the corresponding labels. Also, to be able to investigate the accuracy of the model, we need to separate the data into training set and test set. Below are some codes for preparing the training data and test data, using the <a href="http://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html"><code class="highlighter-rouge">train_test_split</code> function in scikit-learn</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1"># A function for extracting features in documents
</span><span class="k">def</span> <span class="nf">extract_features</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">word2features</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">))]</span>

<span class="c1"># A function fo generating the list of labels for each document
</span><span class="k">def</span> <span class="nf">get_labels</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">label</span> <span class="k">for</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">postag</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">]</span>

<span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">extract_features</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_labels</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</code></pre></div></div>

<p>In <code class="highlighter-rouge">pycrfsuite</code>, A CRF model in can be trained by first creating a <strong>trainer</strong>, and then submit the training data and corresponding labels to the trainer. After that, set the parameters and call <code class="highlighter-rouge">train()</code> to start the training process. For the complete list of parameters, one can refer to the <a href="http://www.chokkan.org/software/crfsuite/manual.html#idp8849114176">documentation of CRFSuite</a>. With the very small dataset in this example, the training with <code class="highlighter-rouge">max_iterations=200</code> can be finished in a few seconds. Below is the code for creating the trainer and start training the model:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pycrfsuite</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">pycrfsuite</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Submit training data to the trainer
</span><span class="k">for</span> <span class="n">xseq</span><span class="p">,</span> <span class="n">yseq</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">):</span>
    <span class="n">trainer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xseq</span><span class="p">,</span> <span class="n">yseq</span><span class="p">)</span>

<span class="c1"># Set the parameters of the model
</span><span class="n">trainer</span><span class="o">.</span><span class="n">set_params</span><span class="p">({</span>
    <span class="c1"># coefficient for L1 penalty
</span>    <span class="s">'c1'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>

    <span class="c1"># coefficient for L2 penalty
</span>    <span class="s">'c2'</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>  

    <span class="c1"># maximum number of iterations
</span>    <span class="s">'max_iterations'</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>

    <span class="c1"># whether to include transitions that
</span>    <span class="c1"># are possible, but not observed
</span>    <span class="s">'feature.possible_transitions'</span><span class="p">:</span> <span class="bp">True</span>
<span class="p">})</span>

<span class="c1"># Provide a file name as a parameter to the train function, such that
# the model will be saved to the file when training is finished
</span><span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="s">'crf.model'</span><span class="p">)</span>
</code></pre></div></div>

<p>If you have set <code class="highlighter-rouge">verbose=True</code> when initialising the trainer, the trainer will print out the training progress as it is trained against the provided training data.</p>

<h3 id="checking-the-results">Checking the Results</h3>

<p>Once we have the model trained, we can apply it on our test data and see whether it gives reasonable results. Assuming that the model is saved to a file named <code class="highlighter-rouge">crf.model</code>. The following block of code shows how we can load the model into memory, and apply it on to our test data.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tagger</span> <span class="o">=</span> <span class="n">pycrfsuite</span><span class="o">.</span><span class="n">Tagger</span><span class="p">()</span>
<span class="n">tagger</span><span class="o">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'crf.model'</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="p">[</span><span class="n">tagger</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">xseq</span><span class="p">)</span> <span class="k">for</span> <span class="n">xseq</span> <span class="ow">in</span> <span class="n">X_test</span><span class="p">]</span>

<span class="c1"># Let's take a look at a random sample in the testing set
</span><span class="n">i</span> <span class="o">=</span> <span class="mi">12</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y_pred</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"="</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X_test</span><span class="p">[</span><span class="n">i</span><span class="p">]]):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">s (</span><span class="si">%</span><span class="s">s)"</span> <span class="o">%</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

<span class="s">'''
The following will be printed:

sci-med (N)
life (N)
systems (N)
inc (N)
said (I)
its (I)
directors (I)
approved (I)
a (I)
previously (I)
...
'''</span>
</code></pre></div></div>

<p>The result looks reasonable as the first four words are correctly identified as part of a named entity.</p>

<p>To study the performance of the CRF tagger trained above in a more quantitative way, we can check the <strong>precision</strong> and <strong>recall</strong> on the test data. This can be done very easily using the <a href="http://scikit-learn.org/stable/modules/generated/sklearn.metrics.classification_report.html"><code class="highlighter-rouge">classification_report</code> function in scikit-learn</a>. However, given that the predictions are sequences of tags, we need to transform the data into a list of labels before feeding them into the function.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>

<span class="c1"># Create a mapping of labels to indices
</span><span class="n">labels</span> <span class="o">=</span> <span class="p">{</span><span class="s">"N"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"I"</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="c1"># Convert the sequences of tags into a 1-dimensional array
</span><span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">labels</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">y_pred</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">row</span><span class="p">])</span>
<span class="n">truths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">labels</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">y_test</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">row</span><span class="p">])</span>

<span class="c1"># Print out the classification report
</span><span class="k">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span>
    <span class="n">truths</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span>
    <span class="n">target_names</span><span class="o">=</span><span class="p">[</span><span class="s">"I"</span><span class="p">,</span> <span class="s">"N"</span><span class="p">]))</span>
</code></pre></div></div>

<p>which will prints a report as follows:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>              <span class="n">precision</span>   <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>
          <span class="n">I</span>       <span class="mf">0.98</span>      <span class="mf">0.98</span>      <span class="mf">0.98</span>      <span class="mi">3322</span>
          <span class="n">N</span>       <span class="mf">0.85</span>      <span class="mf">0.85</span>      <span class="mf">0.85</span>       <span class="mi">405</span>
<span class="n">avg</span> <span class="o">/</span> <span class="n">total</span>       <span class="mf">0.97</span>      <span class="mf">0.97</span>      <span class="mf">0.97</span>      <span class="mi">3727</span>
</code></pre></div></div>

<p>We can see that we have achieved 85% precision and 85% recall in predicting whether a word is part of a named entity. There are several things by which we can improve the performance, including creating better features or tuning the parameters of the CRF model.</p>

<h3 id="source-codes">Source Codes</h3>

<p>The source code for reproducing the above results can be found in the following github repository: <a href="https://github.com/albertauyeung/python-crf-named-entity-recognition">https://github.com/albertauyeung/python-crf-named-entity-recognition</a>.</p>

<h2 id="references">References</h2>

<ul>
  <li>Lafferty, J., McCallum, A., Pereira, F. (2001). <a href="http://repository.upenn.edu/cgi/viewcontent.cgi?article=1162&amp;context=cis_papers">“Conditional random fields: Probabilistic models for segmenting and labeling sequence data”</a>. Proc. 18th International Conf. on Machine Learning. Morgan Kaufmann. pp. 282–289.</li>
  <li>Erdogan, H. (2010). <a href="http://www.icmla-conference.org/icmla10/CFP_Tutorial_files/hakan.pdf">Sequence Labeling: Generative and Discriminative Approaches - Hidden Markov Models, Conditional Random Fields and Structured SVMs</a>. ICMLA 2010 Tutorial.</li>
</ul>
</div><section class="article__sharing d-print-none"></section><div class="d-print-none"><footer class="article__footer"><meta itemprop="dateModified" content="2017-06-17T00:00:00+08:00"><!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
<div class="article__license"></div></footer>
<div class="article__section-navigator clearfix"><div class="previous"><span>PREVIOUS</span><a href="/2017/04/23/python-matrix-factorization.html">Matrix Factorization: A Simple Tutorial and Implementation in Python</a></div><div class="next"><span>NEXT</span><a href="/2017/07/08/fast-pandas-operation.html">Making pandas Operations Faster</a></div></div></div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>
</div><section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div><div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Albert Au Yeung"><meta itemprop="url" content="/"><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><li title="Follow me on Twitter.">
        <a class="button button--circle twitter-button" itemprop="sameAs" href="https://twitter.com/albertauyeung" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M1024.032 194.432c-37.664 16.704-78.176 28-120.672 33.088 43.36-26.016 76.672-67.168 92.384-116.224-40.608 24.064-85.568 41.568-133.408 50.976-38.336-40.832-92.928-66.336-153.344-66.336-116.032 0-210.08 94.048-210.08 210.08 0 16.48 1.856 32.512 5.44 47.872-174.592-8.768-329.408-92.416-433.024-219.52-18.08 31.04-28.448 67.104-28.448 105.632 0 72.896 37.088 137.184 93.472 174.88-34.432-1.088-66.816-10.528-95.168-26.272-0.032 0.864-0.032 1.76-0.032 2.656 0 101.792 72.416 186.688 168.512 205.984-17.632 4.8-36.192 7.36-55.36 7.36-13.536 0-26.688-1.312-39.52-3.776 26.72 83.456 104.32 144.192 196.256 145.888-71.904 56.352-162.496 89.92-260.928 89.92-16.96 0-33.664-0.992-50.112-2.944 92.96 59.616 203.392 94.4 322.048 94.4 386.432 0 597.728-320.128 597.728-597.76 0-9.12-0.192-18.176-0.608-27.168 41.056-29.632 76.672-66.624 104.832-108.736z" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Linkedin.">
        <a class="button button--circle linkedin-button" itemprop="sameAs" href="https://www.linkedin.com/in/albert-au-yeung" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M260.096 155.648c0 27.307008-9.899008 50.516992-29.696 69.632-19.796992 19.115008-45.396992 28.672-76.8 28.672-30.036992 0-54.612992-9.556992-73.728-28.672-19.115008-19.115008-28.672-42.324992-28.672-69.632 0-28.672 9.556992-52.224 28.672-70.656 19.115008-18.432 44.372992-27.648 75.776-27.648 31.403008 0 56.32 9.216 74.752 27.648 18.432 18.432 28.331008 41.984 29.696 70.656 0 0 0 0 0 0m-202.752 808.96c0 0 0-632.832 0-632.832 0 0 196.608 0 196.608 0 0 0 0 632.832 0 632.832 0 0-196.608 0-196.608 0 0 0 0 0 0 0m313.344-430.08c0-58.708992-1.364992-126.292992-4.096-202.752 0 0 169.984 0 169.984 0 0 0 10.24 88.064 10.24 88.064 0 0 4.096 0 4.096 0 40.96-68.267008 105.812992-102.4 194.56-102.4 68.267008 0 123.220992 22.868992 164.864 68.608 41.643008 45.739008 62.464 113.664 62.464 203.776 0 0 0 374.784 0 374.784 0 0-196.608 0-196.608 0 0 0 0-350.208 0-350.208 0-91.476992-33.451008-137.216-100.352-137.216-47.787008 0-81.236992 24.576-100.352 73.728-4.096 8.192-6.144 24.576-6.144 49.152 0 0 0 364.544 0 364.544 0 0-198.656 0-198.656 0 0 0 0-430.08 0-430.08 0 0 0 0 0 0" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/albertauyeung" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z" />
</svg>
</div>
        </a>
      </li></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div>© Albert Au Yeung 2020,
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> & <a
        title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div></div>
    </div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"><script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text" />
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  ⬅, 38  ⬆, 39  ➡, 40  ⬇
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script>
</div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script><script type="text/x-mathjax-config">
	var _config = { tex2jax: {
		inlineMath: [['$','$'], ['\\(','\\)']]
	}};MathJax.Hub.Config(_config);
</script>
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script>

    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>

